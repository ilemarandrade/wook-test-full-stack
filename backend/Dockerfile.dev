FROM node:20-alpine

WORKDIR /usr/src/app

# Herramientas necesarias para Prisma y el wait de Postgres
RUN apk add --no-cache openssl netcat-openbsd

# Instalar dependencias (incluye prisma CLI en node_modules)
COPY package*.json ./
COPY prisma ./prisma/
RUN npm ci
RUN npx prisma generate

# El c√≥digo fuente se monta como volumen desde el host

EXPOSE 4000

# En docker-compose.yml ya se sobreescribe el comando con npm run dev
CMD ["npm", "run", "dev"]

